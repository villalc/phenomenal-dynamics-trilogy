# GitHub Actions Workflow for Automatic Deployment to Hostinger
# 
# This workflow automatically deploys website content to Hostinger
# when changes are pushed to the main branch.
#
# Setup required:
# 1. Go to your repository Settings â†’ Secrets and variables â†’ Actions
# 2. Add the following secrets:
#    - FTP_SERVER_FUNDACION: FTP server for sovereignsymbiosis.com
#    - FTP_USERNAME_FUNDACION: FTP username
#    - FTP_PASSWORD_FUNDACION: FTP password
#    - FTP_SERVER_ENTERPRISE: FTP server for ahigovernance.com
#    - FTP_USERNAME_ENTERPRISE: FTP username
#    - FTP_PASSWORD_ENTERPRISE: FTP password

name: Deploy to Hostinger

on:
  push:
    branches:
      - main
    paths:
      # Only trigger on changes to website content
      - 'site-fundacion/**'
      - 'site-enterprise/**'
  
  # Allow manual trigger from Actions tab
  workflow_dispatch:
    inputs:
      target:
        description: 'Deployment target'
        required: true
        default: 'both'
        type: choice
        options:
          - fundacion
          - enterprise
          - both

jobs:
  deploy-fundacion:
    name: Deploy FundaciÃ³n (sovereignsymbiosis.com)
    runs-on: ubuntu-latest
    
    # Only run if fundacion files changed or manual trigger for fundacion/both
    if: |
      github.event_name == 'push' && 
      contains(github.event.head_commit.modified, 'site-fundacion/') ||
      github.event_name == 'workflow_dispatch' && 
      (github.event.inputs.target == 'fundacion' || github.event.inputs.target == 'both')
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      - name: ðŸ“¤ Deploy to Hostinger via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER_FUNDACION }}
          username: ${{ secrets.FTP_USERNAME_FUNDACION }}
          password: ${{ secrets.FTP_PASSWORD_FUNDACION }}
          local-dir: ./site-fundacion/
          server-dir: /public_html/
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/*.md
            **/PENDING_FILES.md
      
      - name: âœ… Deployment complete
        run: |
          echo "ðŸŽ‰ FundaciÃ³n deployed to sovereignsymbiosis.com"
          echo "ðŸ“ Files from site-fundacion/ uploaded to /public_html/"

  deploy-enterprise:
    name: Deploy Enterprise (ahigovernance.com)
    runs-on: ubuntu-latest
    
    # Only run if enterprise files changed or manual trigger for enterprise/both
    if: |
      github.event_name == 'push' && 
      contains(github.event.head_commit.modified, 'site-enterprise/') ||
      github.event_name == 'workflow_dispatch' && 
      (github.event.inputs.target == 'enterprise' || github.event.inputs.target == 'both')
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      - name: ðŸ“¤ Deploy to Hostinger via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER_ENTERPRISE }}
          username: ${{ secrets.FTP_USERNAME_ENTERPRISE }}
          password: ${{ secrets.FTP_PASSWORD_ENTERPRISE }}
          local-dir: ./site-enterprise/
          server-dir: /public_html/
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/*.md
      
      - name: âœ… Deployment complete
        run: |
          echo "ðŸŽ‰ Enterprise deployed to ahigovernance.com"
          echo "ðŸ“ Files from site-enterprise/ uploaded to /public_html/"

  notify:
    name: Notify Deployment Status
    runs-on: ubuntu-latest
    needs: [deploy-fundacion, deploy-enterprise]
    if: always()
    
    steps:
      - name: ðŸ“Š Deployment Summary
        run: |
          echo "## Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Site | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| FundaciÃ³n | ${{ needs.deploy-fundacion.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Enterprise | ${{ needs.deploy-enterprise.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Deployed at: $(date -u +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
